// esdb v1.0.0
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).esdb={})}(this,function(e){"use strict";function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,n){return(u=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function a(e,n,t){return(a=function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(e){return}}}()?Reflect.construct:function(e,n,t){var r=[null];r.push.apply(r,n);var o=new(Function.bind.apply(e,r));return t&&u(o,t.prototype),o}).apply(null,arguments)}function t(e){var r="function"==typeof Map?new Map:void 0;return(t=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return a(e,arguments,i(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),u(t,e)})(e)}function f(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}var l={},s=function(){function e(){o(this,e)}return n(e,[{key:"init",value:function(){return Promise.resolve()}},{key:"getItem",value:function(n){return new Promise(function(e){e(l[n]||null)})}},{key:"setItem",value:function(n,t){return new Promise(function(e){e(l[n]=t)})}},{key:"removeItem",value:function(t){return new Promise(function(e){var n=null;l.hasOwnProperty(t)&&(n=l[t],delete l[t]),e(n)})}},{key:"clearAllItems",value:function(){return new Promise(function(e){l={},e()})}}]),e}(),y=function(){function e(){o(this,e)}return n(e,[{key:"encrypt",value:function(e){return JSON.stringify(e)}},{key:"decrypt",value:function(e){return JSON.parse(e)}}]),e}(),p=function(){function r(e){var n=e.name,t=void 0===n?"":n;o(this,r),this.name=t}return n(r,[{key:"get",value:function(){return new Promise(function(e,n){})}},{key:"getAll",value:function(){return new Promise(function(e,n){})}},{key:"count",value:function(){return new Promise(function(e,n){})}},{key:"insert",value:function(){return new Promise(function(e,n){})}},{key:"upsert",value:function(){return new Promise(function(e,n){})}},{key:"update",value:function(){return new Promise(function(e,n){})}},{key:"remove",value:function(){return new Promise(function(e,n){})}},{key:"updateIf",value:function(){return new Promise(function(e,n){})}},{key:"removeIf",value:function(){return new Promise(function(e,n){})}},{key:"clear",value:function(){return new Promise(function(e,n){})}}]),r}(),v=function(){function r(e,n){var t;return o(this,r),(t=f(this,i(r).call(this,e))).code=n,t}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&u(e,n)}(r,t(Error)),n(r,null,[{key:"immutableReadyState",value:function(){return new r("Can't change database after getting ready.",700010)}},{key:"databaseNotReady",value:function(){return new r("Database is not ready.",700011)}},{key:"invalidParams",value:function(e){return new r("Invalid parameters: ".concat(0<arguments.length&&void 0!==e?e:"unknown"),703e3)}}]),r}(),m=function(){function e(){o(this,e)}return n(e,null,[{key:"log",value:function(){var e;(e=console).log.apply(e,arguments)}},{key:"warning",value:function(){var e;(e=console).warning.apply(e,arguments)}},{key:"error",value:function(){var e;(e=console).error.apply(e,arguments)}}]),e}(),d=null,b=null,h=new(function(){function e(){return o(this,e),d||(b={name:"",version:1,baseStore:new s,encryption:new y,schema:{},collection:{},error:null,state:e.State.INIT},d=this),d}return n(e,[{key:"name",value:function(e){return b.error||("string"==typeof e&&e?this.isInit?b.name=e:b.error=v.immutableReadyState():b.error=v.invalidParams("esdb.name(".concat(e,")"))),this}},{key:"version",value:function(e){return b.error||("number"==typeof e&&0<e?this.isInit?b.version=e:b.error=v.immutableReadyState():b.error=v.invalidParams("esdb.version(".concat(e,")"))),this}},{key:"baseStore",value:function(e){return b.error||(e instanceof s?this.isInit?b.baseStore=e:b.error=v.immutableReadyState():b.error=v.invalidParams("esdb.baseStore(".concat(e,")"))),this}},{key:"encryption",value:function(e){return b.error||(e instanceof y?this.isInit?b.encryption=e:b.error=v.immutableReadyState():b.error=v.invalidParams("esdb.encryption(".concat(e,")"))),this}},{key:"schema",value:function(e){if(!b.error){var n=e.name,t=e.model,r=e.key,o=e.indexes,i=void 0===o?[]:o,u=e.migrate,a=void 0===u?null:u;"string"==typeof n&&n&&"object"===c(t)&&t&&"string"==typeof r&&r&&Array.isArray(i)&&i.every(function(e){return Array.isArray(e)&&0<e.length&&e.every(function(e){return"string"==typeof e&&t.hasOwnProperty(e)})})&&("function"==typeof a||null===a)?this.isInit?b.schema[n]={model:t,key:r,indexes:i,migrate:a}:b.error=v.immutableReadyState():b.error=v.invalidParams("esdb.schema(".concat(e,")"))}return this}},{key:"build",value:function(e){var t=0<arguments.length&&void 0!==e?e:{};return new Promise(function(e,n){if(b.error)m.error(b.error.message),n(b.error);else t.batchSize,t.batchInterval,t.cacheBlockLimit,t.cacheBlockFlush})}},{key:"collection",value:function(e){var n=null;return b.error||(this.isReady?"string"==typeof e&&b.collection.hasOwnProperty(e)&&b.collection[e]instanceof p?n=b.collection[e]:m.error(v.invalidParams("esdb.collection(".concat(e,")"))):m.error(v.databaseNotReady())),n}},{key:"isInit",get:function(){return b.state===e.State.INIT}},{key:"isReady",get:function(){return b.state===e.State.READY}}],[{key:"State",get:function(){return{INIT:"init",READY:"ready"}}}]),e}());e.EsdbBaseStore=s,e.EsdbEncryption=y,e.EsdbError=v,e.EsdbQuery=function e(){o(this,e)},e.default=h,Object.defineProperty(e,"__esModule",{value:!0})});